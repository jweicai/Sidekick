# 🚀 许可证系统快速开始

## 5分钟快速测试

### 1. 生成测试激活码（1分钟）

```bash
# 在项目根目录运行
./test_license.sh
```

这会输出：
- 测试邮箱
- 你的机器码
- 生成的激活码

**复制激活码备用！**

### 2. 构建并运行应用（2分钟）

```bash
# 在 Xcode 中打开
open Package.swift

# 或使用命令行
xcodebuild -scheme Sidekick -destination 'platform=macOS' build
```

### 3. 测试试用期（1分钟）

1. 启动应用
2. 查看菜单栏：应该显示"试用期剩余 90 天"
3. 打开设置 → 许可证：查看详细信息

### 4. 测试激活（1分钟）

1. 点击"激活"按钮
2. 输入：
   - 邮箱：`test@example.com`
   - 激活码：（从步骤1复制的）
3. 点击"激活"
4. 应该显示"激活成功"

## 完整测试流程

### 测试场景 1：首次启动

```bash
# 清除数据
defaults delete com.yourcompany.Sidekick Sidekick.License 2>/dev/null
defaults delete com.yourcompany.Sidekick Sidekick.TrialStart 2>/dev/null

# 启动应用
# 应该看到：试用期剩余 90 天
```

### 测试场景 2：试用期过期

```bash
# 模拟 91 天后
defaults write com.yourcompany.Sidekick Sidekick.TrialStart -date "$(date -v-91d)"

# 重启应用
# 应该看到：全屏遮罩，功能锁定
```

### 测试场景 3：激活恢复

```bash
# 在过期状态下
# 1. 点击"激活许可证"
# 2. 输入激活码
# 3. 激活成功
# 4. 遮罩消失，功能恢复
```

## 常见问题

### Q: 激活码格式不正确？
A: 确保格式为 `XXXX-XXXX-XXXX-XXXX`，全大写，用短横线分隔

### Q: 激活码无效？
A: 检查：
1. 邮箱是否正确
2. 机器码是否匹配
3. 密钥是否一致（`LicenseManager.swift` 和 `generate_license.swift`）

### Q: 如何重置测试？
A: 运行：
```bash
defaults delete com.yourcompany.Sidekick Sidekick.License
defaults delete com.yourcompany.Sidekick Sidekick.TrialStart
```

### Q: 如何查看机器码？
A: 在应用的设置 → 许可证中，点击"复制"按钮

## 发布前检查清单

- [ ] 修改 `SIDEKICK_SECRET` 为随机字符串
- [ ] 修改购买链接为实际地址
- [ ] 设置正确的 Bundle Identifier
- [ ] 测试所有场景
- [ ] 准备激活码发送流程
- [ ] 准备用户文档

## 下一步

1. 测试完成后，查看 `docs/许可证系统说明.md` 了解详细信息
2. 准备购买页面和支付流程
3. 设计激活码发送邮件模板
4. 准备客服支持流程

---

**开始测试吧！** 🎉
