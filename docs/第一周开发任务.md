# TableQuery ç¬¬ä¸€å‘¨å¼€å‘ä»»åŠ¡

## ğŸ“… Week 1ï¼šé¡¹ç›®æ­å»º + æ ¸å¿ƒåŠŸèƒ½

### ğŸ¯ æœ¬å‘¨ç›®æ ‡
- åˆ›å»º Xcode é¡¹ç›®
- å®ç°æ–‡ä»¶æ‹–æ‹½åŠŸèƒ½
- å®ç° CSV è§£æ
- éªŒè¯æŠ€æœ¯å¯è¡Œæ€§

---

## âœ… ä»»åŠ¡æ¸…å•

### Day 1-2ï¼šé¡¹ç›®æ­å»º
- [x] é¡¹ç›®ç«‹é¡¹
- [x] åˆ›å»º Git ä»“åº“
- [x] é¡¹ç›®æ”¹åä¸º TableQuery
- [ ] åˆ›å»º Xcode é¡¹ç›®
- [ ] é…ç½®é¡¹ç›®ç»“æ„
- [ ] è®¾ç½® Git å¿½ç•¥æ–‡ä»¶

### Day 3-4ï¼šUI è®¾è®¡ä¸å®ç°
- [ ] è®¾è®¡ä¸»ç•Œé¢å¸ƒå±€
- [ ] å®ç°æ–‡ä»¶æ‹–æ‹½åŒºåŸŸ
- [ ] å®ç°åŸºç¡€ UI ç»„ä»¶
- [ ] æµ‹è¯•æ‹–æ‹½åŠŸèƒ½

### Day 5-6ï¼šCSV è§£æ
- [ ] å®ç° CSV è§£æå™¨
- [ ] æ•°æ®ç±»å‹æ¨æ–­
- [ ] æµ‹è¯•ä¸åŒæ ¼å¼çš„ CSV
- [ ] å¤„ç†è¾¹ç•Œæƒ…å†µ

### Day 7ï¼šæµ‹è¯•ä¸ä¼˜åŒ–
- [ ] æ•´ä½“æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] Bug ä¿®å¤
- [ ] ä»£ç æäº¤

---

## ğŸ› ï¸ æŠ€æœ¯è¦ç‚¹

### 1. åˆ›å»º Xcode é¡¹ç›®

**æ­¥éª¤**ï¼š
1. æ‰“å¼€ Xcode
2. File â†’ New â†’ Project
3. é€‰æ‹© macOS â†’ App
4. é…ç½®ï¼š
   - Product Name: TableQuery
   - Team: é€‰æ‹©ä½ çš„å¼€å‘è€…è´¦å·
   - Organization Identifier: com.yourname
   - Interface: SwiftUI
   - Language: Swift
   - å–æ¶ˆå‹¾é€‰ Core Dataã€Testsï¼ˆåç»­å†åŠ ï¼‰

5. ä¿å­˜ä½ç½®ï¼š`~/tools/TableQuery/`

---

### 2. é¡¹ç›®ç»“æ„

åˆ›å»ºä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
TableQuery/
â”œâ”€â”€ TableQuery/
â”‚   â”œâ”€â”€ App/
â”‚   â”‚   â””â”€â”€ TableQueryApp.swift
â”‚   â”œâ”€â”€ Views/
â”‚   â”‚   â”œâ”€â”€ MainView.swift
â”‚   â”‚   â””â”€â”€ FileDropZone.swift
â”‚   â”œâ”€â”€ ViewModels/
â”‚   â”‚   â””â”€â”€ MainViewModel.swift
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â””â”€â”€ DataFrame.swift
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â””â”€â”€ FileLoader/
â”‚   â”‚       â””â”€â”€ CSVLoader.swift
â”‚   â””â”€â”€ Resources/
â”‚       â””â”€â”€ Assets.xcassets
```

---

### 3. æ–‡ä»¶æ‹–æ‹½å®ç°

**FileDropZone.swift**ï¼š
```swift
import SwiftUI
import UniformTypeIdentifiers

struct FileDropZone: View {
    @Binding var droppedFileURL: URL?
    @State private var isTargeted = false
    
    var body: some View {
        VStack {
            Image(systemName: "doc.badge.plus")
                .font(.system(size: 60))
                .foregroundColor(isTargeted ? .blue : .gray)
            
            Text("æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œ")
                .font(.title2)
                .foregroundColor(.secondary)
            
            Text("æ”¯æŒ CSV, Excel, JSON")
                .font(.caption)
                .foregroundColor(.secondary)
        }
        .frame(maxWidth: .infinity, maxHeight: .infinity)
        .background(
            RoundedRectangle(cornerRadius: 12)
                .strokeBorder(
                    isTargeted ? Color.blue : Color.gray.opacity(0.3),
                    style: StrokeStyle(lineWidth: 2, dash: [10])
                )
        )
        .onDrop(of: [.fileURL], isTargeted: $isTargeted) { providers in
            handleDrop(providers: providers)
        }
    }
    
    private func handleDrop(providers: [NSItemProvider]) -> Bool {
        guard let provider = providers.first else { return false }
        
        provider.loadItem(forTypeIdentifier: UTType.fileURL.identifier, options: nil) { item, error in
            guard let data = item as? Data,
                  let url = URL(dataRepresentation: data, relativeTo: nil) else {
                return
            }
            
            DispatchQueue.main.async {
                self.droppedFileURL = url
            }
        }
        
        return true
    }
}
```

---

### 4. CSV è§£æå™¨

**CSVLoader.swift**ï¼š
```swift
import Foundation

struct DataFrame {
    let columns: [String]
    let rows: [[String]]
    
    var rowCount: Int { rows.count }
    var columnCount: Int { columns.count }
}

class CSVLoader {
    func load(from url: URL) throws -> DataFrame {
        let content = try String(contentsOf: url, encoding: .utf8)
        return try parse(content: content)
    }
    
    private func parse(content: String) throws -> DataFrame {
        let lines = content.components(separatedBy: .newlines)
            .filter { !$0.isEmpty }
        
        guard !lines.isEmpty else {
            throw CSVError.emptyFile
        }
        
        // è§£æè¡¨å¤´
        let columns = parseRow(lines[0])
        
        // è§£ææ•°æ®è¡Œ
        let rows = lines.dropFirst().map { parseRow($0) }
        
        return DataFrame(columns: columns, rows: rows)
    }
    
    private func parseRow(_ line: String) -> [String] {
        // ç®€å•å®ç°ï¼Œåç»­éœ€è¦å¤„ç†å¼•å·ã€é€—å·ç­‰ç‰¹æ®Šæƒ…å†µ
        return line.components(separatedBy: ",")
            .map { $0.trimmingCharacters(in: .whitespaces) }
    }
}

enum CSVError: Error {
    case emptyFile
    case invalidFormat
}
```

---

### 5. ä¸»è§†å›¾

**MainView.swift**ï¼š
```swift
import SwiftUI

struct MainView: View {
    @StateObject private var viewModel = MainViewModel()
    
    var body: some View {
        VStack(spacing: 0) {
            // é¡¶éƒ¨å·¥å…·æ 
            HStack {
                Text("TableQuery")
                    .font(.title2)
                    .fontWeight(.bold)
                Spacer()
            }
            .padding()
            .background(Color(NSColor.windowBackgroundColor))
            
            Divider()
            
            // ä¸»å†…å®¹åŒº
            if viewModel.dataFrame == nil {
                // æ–‡ä»¶æ‹–æ‹½åŒºåŸŸ
                FileDropZone(droppedFileURL: $viewModel.fileURL)
                    .padding()
            } else {
                // æ•°æ®å±•ç¤ºåŒºåŸŸ
                DataView(dataFrame: viewModel.dataFrame!)
            }
        }
        .frame(minWidth: 800, minHeight: 600)
    }
}

struct DataView: View {
    let dataFrame: DataFrame
    
    var body: some View {
        VStack {
            Text("å·²åŠ è½½ \(dataFrame.rowCount) è¡Œæ•°æ®")
                .font(.headline)
                .padding()
            
            // ç®€å•çš„è¡¨æ ¼å±•ç¤º
            ScrollView([.horizontal, .vertical]) {
                VStack(alignment: .leading, spacing: 0) {
                    // è¡¨å¤´
                    HStack(spacing: 0) {
                        ForEach(dataFrame.columns, id: \.self) { column in
                            Text(column)
                                .frame(width: 150, alignment: .leading)
                                .padding(8)
                                .background(Color.gray.opacity(0.2))
                        }
                    }
                    
                    // æ•°æ®è¡Œï¼ˆåªæ˜¾ç¤ºå‰100è¡Œï¼‰
                    ForEach(0..<min(100, dataFrame.rowCount), id: \.self) { rowIndex in
                        HStack(spacing: 0) {
                            ForEach(0..<dataFrame.columnCount, id: \.self) { colIndex in
                                Text(dataFrame.rows[rowIndex][colIndex])
                                    .frame(width: 150, alignment: .leading)
                                    .padding(8)
                            }
                        }
                        .background(rowIndex % 2 == 0 ? Color.clear : Color.gray.opacity(0.05))
                    }
                }
            }
        }
    }
}
```

---

### 6. ViewModel

**MainViewModel.swift**ï¼š
```swift
import Foundation
import Combine

class MainViewModel: ObservableObject {
    @Published var fileURL: URL? {
        didSet {
            if let url = fileURL {
                loadFile(url: url)
            }
        }
    }
    
    @Published var dataFrame: DataFrame?
    @Published var isLoading = false
    @Published var errorMessage: String?
    
    private let csvLoader = CSVLoader()
    
    private func loadFile(url: URL) {
        isLoading = true
        errorMessage = nil
        
        DispatchQueue.global(qos: .userInitiated).async { [weak self] in
            do {
                let dataFrame = try self?.csvLoader.load(from: url)
                
                DispatchQueue.main.async {
                    self?.dataFrame = dataFrame
                    self?.isLoading = false
                }
            } catch {
                DispatchQueue.main.async {
                    self?.errorMessage = error.localizedDescription
                    self?.isLoading = false
                }
            }
        }
    }
}
```

---

## ğŸ§ª æµ‹è¯•

### æµ‹è¯•æ–‡ä»¶

åˆ›å»ºæµ‹è¯• CSV æ–‡ä»¶ï¼š`test.csv`

```csv
id,name,age,city
1,å¼ ä¸‰,25,åŒ—äº¬
2,æå››,30,ä¸Šæµ·
3,ç‹äº”,28,æ·±åœ³
```

### æµ‹è¯•æ­¥éª¤

1. è¿è¡Œåº”ç”¨
2. æ‹–æ‹½ test.csv åˆ°åº”ç”¨
3. éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
4. æ£€æŸ¥è¡¨å¤´å’Œæ•°æ®è¡Œ

---

## ğŸ“ æœ¬å‘¨æ€»ç»“

å®Œæˆåï¼Œä½ åº”è¯¥æœ‰ï¼š
- âœ… ä¸€ä¸ªå¯è¿è¡Œçš„ Xcode é¡¹ç›®
- âœ… æ–‡ä»¶æ‹–æ‹½åŠŸèƒ½
- âœ… CSV è§£æåŠŸèƒ½
- âœ… åŸºç¡€æ•°æ®å±•ç¤º

**ä¸‹å‘¨ä»»åŠ¡é¢„å‘Š**ï¼š
- é›†æˆ SQLite
- å®ç° SQL æŸ¥è¯¢åŠŸèƒ½
- å®ç°æŸ¥è¯¢ç»“æœå±•ç¤º

---

## ğŸ’¡ å¼€å‘å»ºè®®

1. **å°æ­¥å¿«è·‘**ï¼šå…ˆå®ç°æœ€ç®€å•çš„ç‰ˆæœ¬ï¼Œå†é€æ­¥ä¼˜åŒ–
2. **é¢‘ç¹æµ‹è¯•**ï¼šæ¯å®Œæˆä¸€ä¸ªåŠŸèƒ½å°±æµ‹è¯•
3. **åŠæ—¶æäº¤**ï¼šæ¯å¤©æäº¤ä»£ç åˆ° Git
4. **è®°å½•é—®é¢˜**ï¼šé‡åˆ°é—®é¢˜è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿åç»­è§£å†³

---

**å‡†å¤‡å¥½å¼€å§‹ç¼–ç äº†å—ï¼Ÿ** ğŸš€

ä¸‹ä¸€æ­¥ï¼šåˆ›å»º Xcode é¡¹ç›®ï¼
