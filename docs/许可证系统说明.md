# Sidekick 许可证系统说明

## 📋 概述

Sidekick 采用 **90天试用 + 激活码** 的许可证模式：
- 90天全功能试用期
- 试用期结束后需要购买激活码
- 激活码绑定机器码，一机一码
- 买断制，永久使用

## 🔧 技术实现

### 1. 机器码生成

机器码基于硬件 UUID 生成，确保唯一性和稳定性：

```swift
let machineID = MachineID.get()
// 示例: "12345678-1234-1234-1234-123456789ABC"
```

### 2. 激活码格式

激活码格式：`XXXX-XXXX-XXXX-XXXX`

示例：`A1B2-C3D4-E5F6-G7H8`

### 3. 激活码生成算法

```
激活码 = SHA256(email + machineID + SECRET).前16位
```

## 🎯 使用流程

### 用户端流程

1. **首次启动**
   - 自动开始 90 天试用期
   - 显示剩余天数

2. **试用期内**
   - 所有功能正常使用
   - 界面提示剩余天数

3. **试用期结束**
   - 功能锁定
   - 显示激活界面
   - 提示购买激活码

4. **购买激活码**
   - 用户提供邮箱和机器码
   - 开发者生成激活码
   - 用户输入激活码激活

5. **激活成功**
   - 永久使用
   - 绑定当前设备

### 开发者端流程

1. **接收购买请求**
   - 用户提供：邮箱 + 机器码
   - 确认付款

2. **生成激活码**
   ```bash
   swift generate_license.swift user@email.com MACHINE-ID
   ```

3. **发送激活码**
   - 通过邮件发送给用户
   - 包含使用说明

## 🛠️ 激活码生成工具

### 使用方法

```bash
# 基本用法
swift generate_license.swift <email> <machineID>

# 示例
swift generate_license.swift test@example.com 12345678-1234-1234-1234-123456789ABC
```

### 输出示例

```
🔑 Sidekick License Generator
==================================================

✅ 激活码生成成功！

邮箱地址: test@example.com
机器码:   12345678-1234-1234-1234-123456789ABC
激活码:   A1B2-C3D4-E5F6-G7H8

==================================================
💡 请将激活码发送给用户
```

## 📝 激活码邮件模板

```
主题：Sidekick 激活码

您好，

感谢您购买 Sidekick！

您的激活信息：
- 邮箱地址：user@email.com
- 激活码：XXXX-XXXX-XXXX-XXXX

激活步骤：
1. 打开 Sidekick 应用
2. 点击"激活"按钮
3. 输入您的邮箱地址和激活码
4. 点击"激活"完成

注意事项：
- 激活码已绑定您的设备
- 如需更换设备，请联系客服
- 激活后可永久使用

如有问题，请联系：support@sidekick.com

祝使用愉快！
Sidekick 团队
```

## 🔐 安全性

### 1. 机器码绑定
- 激活码与机器码绑定
- 无法在其他设备使用
- 防止激活码共享

### 2. 本地验证
- 激活码验证在本地完成
- 无需联网验证
- 离线可用

### 3. 加密存储
- 许可证信息加密存储
- 使用 UserDefaults 保存
- 防止篡改

## ⚠️ 注意事项

### 1. 机器码获取

用户可以在激活界面看到自己的机器码：
- 显示前16位 + "..."
- 提供"复制"按钮
- 购买时需要提供完整机器码

### 2. 激活码管理

建议使用表格记录：

| 邮箱 | 机器码 | 激活码 | 购买日期 | 状态 |
|------|--------|--------|----------|------|
| user@email.com | 1234... | XXXX-... | 2025-01-14 | 已激活 |

### 3. 设备更换

如果用户更换设备：
1. 需要重新购买激活码
2. 或者提供"设备迁移"服务（额外收费）
3. 建议在购买页面说明清楚

## 🧪 测试

### 生成测试激活码

```bash
# 获取当前机器的机器码
# 在应用中查看，或运行：
swift -e "import IOKit; print(IORegistryEntryCreateCFProperty(IOServiceGetMatchingService(kIOMainPortDefault, IOServiceMatching(\"IOPlatformExpertDevice\")), kIOPlatformUUIDKey as CFString, kCFAllocatorDefault, 0).takeUnretainedValue())"

# 生成测试激活码
swift generate_license.swift test@example.com YOUR-MACHINE-ID
```

### 测试流程

1. 删除试用记录（测试用）：
   ```bash
   defaults delete com.yourcompany.Sidekick Sidekick.TrialStart
   defaults delete com.yourcompany.Sidekick Sidekick.License
   ```

2. 启动应用，验证试用期显示

3. 修改试用开始时间（测试过期）：
   ```bash
   # 设置为 91 天前
   defaults write com.yourcompany.Sidekick Sidekick.TrialStart -date "$(date -v-91d)"
   ```

4. 重启应用，验证过期提示

5. 使用生成的激活码测试激活

## 📊 数据统计

建议记录以下数据：
- 总下载量
- 试用用户数
- 付费转化率
- 激活码使用情况
- 用户反馈

## 🚀 未来优化

可选的增强功能：
1. 在线激活验证（防止破解）
2. 支持多设备激活（家庭版）
3. 订阅制（年付）
4. 自动续费
5. 团队许可证

## 📞 技术支持

如有问题，请联系：
- 邮箱：support@sidekick.com
- 文档：docs.sidekick.com
- GitHub：github.com/yourname/sidekick

---

**最后更新：2025-01-14**
