# Sidekick æ’ä»¶å¼€å‘æŒ‡å—

## ğŸ¯ æ’ä»¶æ¶æ„æ¦‚è¿°

Sidekick é‡‡ç”¨æ’ä»¶åŒ–æ¶æ„ï¼Œæ”¯æŒåŠ¨æ€æ‰©å±•æ–°çš„æ–‡ä»¶æ ¼å¼æ”¯æŒã€‚

### æ ¸å¿ƒç»„ä»¶

1. **FileLoaderProtocol**ï¼šæ–‡ä»¶åŠ è½½å™¨åè®®
2. **FileLoaderManager**ï¼šæ’ä»¶ç®¡ç†å™¨ï¼ˆå•ä¾‹ï¼‰
3. **å…·ä½“å®ç°**ï¼šCSVLoaderã€JSONLoader ç­‰

---

## ğŸ“¦ æ’ä»¶æ¶æ„è®¾è®¡

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MainViewModel                   â”‚
â”‚  (ä¸ä¾èµ–å…·ä½“å®ç°ï¼Œåªä¾èµ–åè®®)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      FileLoaderManager (å•ä¾‹)           â”‚
â”‚  - ç®¡ç†æ‰€æœ‰åŠ è½½å™¨æ’ä»¶                    â”‚
â”‚  - æ ¹æ®æ–‡ä»¶ç±»å‹é€‰æ‹©åˆé€‚çš„åŠ è½½å™¨           â”‚
â”‚  - æ”¯æŒåŠ¨æ€æ³¨å†Œ/æ³¨é”€æ’ä»¶                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      FileLoaderProtocol (åè®®)          â”‚
â”‚  - name: String                         â”‚
â”‚  - version: String                      â”‚
â”‚  - supportedTypes: [UTType]             â”‚
â”‚  - supportedExtensions: [String]        â”‚
â”‚  - canLoad(url:) -> Bool                â”‚
â”‚  - load(from:) -> DataFrame             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼               â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CSVLoader â”‚    â”‚JSONLoaderâ”‚  â”‚ExcelLoaderâ”‚
â”‚  (å†…ç½®)  â”‚    â”‚  (å†…ç½®)  â”‚  â”‚  (æ’ä»¶)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ å¦‚ä½•å¼€å‘æ’ä»¶

### æ­¥éª¤1ï¼šå®ç° FileLoaderProtocol

åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œå®ç° `FileLoaderProtocol` åè®®ï¼š

```swift
import Foundation
import UniformTypeIdentifiers

class MyCustomLoader: FileLoaderProtocol {
    
    // MARK: - å¿…é¡»å®ç°çš„å±æ€§
    
    var name: String { "My Custom Loader" }
    var version: String { "1.0.0" }
    var supportedTypes: [UTType] { [.plainText] }
    var supportedExtensions: [String] { ["custom", "txt"] }
    
    // MARK: - å¿…é¡»å®ç°çš„æ–¹æ³•
    
    func load(from url: URL) throws -> DataFrame {
        // 1. è¯»å–æ–‡ä»¶å†…å®¹
        let content = try String(contentsOf: url, encoding: .utf8)
        
        // 2. è§£ææ–‡ä»¶å†…å®¹
        let (columns, rows) = try parseContent(content)
        
        // 3. è¿”å› DataFrame
        return DataFrame(columnNames: columns, rows: rows)
    }
    
    // MARK: - ç§æœ‰æ–¹æ³•
    
    private func parseContent(_ content: String) throws -> ([String], [[String]]) {
        // å®ç°ä½ çš„è§£æé€»è¾‘
        // ...
        return (columns, rows)
    }
}
```

---

### æ­¥éª¤2ï¼šæ³¨å†Œæ’ä»¶

åœ¨åº”ç”¨å¯åŠ¨æ—¶æ³¨å†Œä½ çš„æ’ä»¶ï¼š

```swift
// åœ¨ SidekickApp.swift ä¸­
@main
struct SidekickApp: App {
    
    init() {
        // æ³¨å†Œè‡ªå®šä¹‰æ’ä»¶
        FileLoaderManager.shared.register(loader: MyCustomLoader())
    }
    
    var body: some Scene {
        WindowGroup {
            MainView()
        }
    }
}
```

---

### æ­¥éª¤3ï¼šæµ‹è¯•æ’ä»¶

1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶ï¼ˆå¦‚ `test.custom`ï¼‰
2. è¿è¡Œåº”ç”¨
3. æ‹–æ‹½æµ‹è¯•æ–‡ä»¶åˆ°åº”ç”¨
4. éªŒè¯æ˜¯å¦æ­£ç¡®åŠ è½½

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹ï¼šExcel åŠ è½½å™¨

```swift
import Foundation
import UniformTypeIdentifiers

/// Excel æ–‡ä»¶åŠ è½½å™¨
class ExcelLoader: FileLoaderProtocol {
    
    // MARK: - FileLoaderProtocol
    
    var name: String { "Excel Loader" }
    var version: String { "1.0.0" }
    var supportedTypes: [UTType] { 
        [
            UTType(filenameExtension: "xlsx")!,
            UTType(filenameExtension: "xls")!
        ] 
    }
    var supportedExtensions: [String] { ["xlsx", "xls"] }
    
    // MARK: - Public Methods
    
    func load(from url: URL) throws -> DataFrame {
        // ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ CoreXLSXï¼‰è§£æ Excel
        // è¿™é‡Œæ˜¯ä¼ªä»£ç ç¤ºä¾‹
        
        // 1. æ‰“å¼€ Excel æ–‡ä»¶
        let workbook = try openWorkbook(url)
        
        // 2. è¯»å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
        let sheet = workbook.sheets[0]
        
        // 3. æå–åˆ—åï¼ˆç¬¬ä¸€è¡Œï¼‰
        let columnNames = sheet.rows[0].cells.map { $0.value }
        
        // 4. æå–æ•°æ®è¡Œ
        let rows = sheet.rows.dropFirst().map { row in
            row.cells.map { $0.value }
        }
        
        // 5. è¿”å› DataFrame
        return DataFrame(columnNames: columnNames, rows: rows)
    }
    
    // MARK: - Private Methods
    
    private func openWorkbook(_ url: URL) throws -> Workbook {
        // å®ç° Excel æ–‡ä»¶æ‰“å¼€é€»è¾‘
        // å¯ä»¥ä½¿ç”¨ CoreXLSX æˆ–å…¶ä»–åº“
        fatalError("Not implemented")
    }
}

// æ³¨å†Œæ’ä»¶
FileLoaderManager.shared.register(loader: ExcelLoader())
```

---

## ğŸ¨ æ’ä»¶æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†

å®šä¹‰æ¸…æ™°çš„é”™è¯¯ç±»å‹ï¼š

```swift
enum MyLoaderError: Error, LocalizedError {
    case emptyFile
    case invalidFormat
    case unsupportedVersion
    
    var errorDescription: String? {
        switch self {
        case .emptyFile:
            return "æ–‡ä»¶ä¸ºç©º"
        case .invalidFormat:
            return "æ–‡ä»¶æ ¼å¼æ— æ•ˆ"
        case .unsupportedVersion:
            return "ä¸æ”¯æŒçš„æ–‡ä»¶ç‰ˆæœ¬"
        }
    }
}
```

### 2. æ€§èƒ½ä¼˜åŒ–

å¯¹äºå¤§æ–‡ä»¶ï¼Œä½¿ç”¨æµå¼å¤„ç†ï¼š

```swift
func load(from url: URL) throws -> DataFrame {
    let fileHandle = try FileHandle(forReadingFrom: url)
    defer { try? fileHandle.close() }
    
    var rows: [[String]] = []
    let chunkSize = 1024 * 1024 // 1MB
    
    while let chunk = try fileHandle.read(upToCount: chunkSize) {
        // å¤„ç†æ¯ä¸ªå—
        let parsedRows = parseChunk(chunk)
        rows.append(contentsOf: parsedRows)
    }
    
    return DataFrame(columnNames: columns, rows: rows)
}
```

### 3. ç±»å‹æ¨æ–­

å¤ç”¨ç°æœ‰çš„ç±»å‹æ¨æ–­é€»è¾‘ï¼š

```swift
// å¯ä»¥åˆ›å»ºä¸€ä¸ªå…±äº«çš„å·¥å…·ç±»
class TypeInferenceHelper {
    static func inferType(from values: [String]) -> ColumnType {
        // ç±»å‹æ¨æ–­é€»è¾‘
        // ...
    }
}
```

### 4. æ—¥å¿—è®°å½•

æ·»åŠ é€‚å½“çš„æ—¥å¿—ï¼š

```swift
func load(from url: URL) throws -> DataFrame {
    print("ğŸ“‚ [\(name)] Loading file: \(url.lastPathComponent)")
    
    let startTime = Date()
    let dataFrame = try parseFile(url)
    let duration = Date().timeIntervalSince(startTime)
    
    print("âœ… [\(name)] Loaded \(dataFrame.rowCount) rows in \(duration)s")
    
    return dataFrame
}
```

---

## ğŸ”Œ æ’ä»¶ç®¡ç† API

### æ³¨å†Œæ’ä»¶

```swift
FileLoaderManager.shared.register(loader: MyLoader())
```

### æ³¨é”€æ’ä»¶

```swift
FileLoaderManager.shared.unregister(loaderName: "My Loader")
```

### è·å–æ‰€æœ‰æ’ä»¶

```swift
let loaders = FileLoaderManager.shared.allLoaders()
for loader in loaders {
    print("\(loader.name) v\(loader.version)")
}
```

### æŸ¥æ‰¾åˆé€‚çš„æ’ä»¶

```swift
if let loader = FileLoaderManager.shared.findLoader(for: url) {
    print("Found loader: \(loader.name)")
}
```

### è·å–æ”¯æŒçš„æ–‡ä»¶ç±»å‹

```swift
let extensions = FileLoaderManager.shared.supportedExtensions()
print("Supported: \(extensions.joined(separator: ", "))")
```

---

## ğŸ“¦ å†…ç½®æ’ä»¶

### 1. CSVLoader
- **æ”¯æŒæ ¼å¼**ï¼šCSV, TXT
- **ç‰¹æ€§**ï¼š
  - æ”¯æŒå¼•å·å’Œé€—å·
  - è‡ªåŠ¨ç±»å‹æ¨æ–­
  - å¤„ç†ç©ºå€¼

### 2. JSONLoader
- **æ”¯æŒæ ¼å¼**ï¼šJSON, JSONL
- **ç‰¹æ€§**ï¼š
  - æ”¯æŒ JSON æ•°ç»„
  - æ”¯æŒ JSONLï¼ˆæ¯è¡Œä¸€ä¸ª JSONï¼‰
  - è‡ªåŠ¨æå–é”®åä½œä¸ºåˆ—å

---

## ğŸš€ æœªæ¥æ‰©å±•æ–¹å‘

### è®¡åˆ’ä¸­çš„æ’ä»¶

1. **ExcelLoader**ï¼šæ”¯æŒ .xlsx, .xls
2. **ParquetLoader**ï¼šæ”¯æŒ Apache Parquet
3. **AvroLoader**ï¼šæ”¯æŒ Apache Avro
4. **XMLLoader**ï¼šæ”¯æŒ XML æ–‡ä»¶
5. **SQLiteLoader**ï¼šæ”¯æŒ SQLite æ•°æ®åº“æ–‡ä»¶

### ç¬¬ä¸‰æ–¹æ’ä»¶ç”Ÿæ€

æœªæ¥å¯ä»¥ï¼š
1. å¼€æ”¾æ’ä»¶ API æ–‡æ¡£
2. å»ºç«‹æ’ä»¶å¸‚åœº
3. æ”¯æŒä» GitHub å®‰è£…æ’ä»¶
4. æ’ä»¶ç­¾åå’ŒéªŒè¯

---

## ğŸ’¡ æ’ä»¶å¼€å‘æŠ€å·§

### 1. ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“

åœ¨ `Package.swift` ä¸­æ·»åŠ ä¾èµ–ï¼š

```swift
dependencies: [
    .package(url: "https://github.com/CoreOffice/CoreXLSX.git", from: "0.14.0")
],
targets: [
    .target(
        name: "Sidekick",
        dependencies: ["CoreXLSX"]
    )
]
```

### 2. å•å…ƒæµ‹è¯•

ä¸ºä½ çš„æ’ä»¶ç¼–å†™æµ‹è¯•ï¼š

```swift
import XCTest
@testable import Sidekick

class MyLoaderTests: XCTestCase {
    func testLoadFile() throws {
        let loader = MyCustomLoader()
        let url = Bundle.module.url(forResource: "test", withExtension: "custom")!
        let dataFrame = try loader.load(from: url)
        
        XCTAssertEqual(dataFrame.rowCount, 10)
        XCTAssertEqual(dataFrame.columnCount, 5)
    }
}
```

### 3. æ€§èƒ½åŸºå‡†æµ‹è¯•

```swift
func testPerformance() {
    measure {
        let loader = MyCustomLoader()
        _ = try? loader.load(from: largeFileURL)
    }
}
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Swift Package Manager](https://swift.org/package-manager/)
- [UniformTypeIdentifiers](https://developer.apple.com/documentation/uniformtypeidentifiers)
- [CoreXLSX](https://github.com/CoreOffice/CoreXLSX)

---

## ğŸ‰ æ€»ç»“

Sidekick çš„æ’ä»¶æ¶æ„è®©ä½ å¯ä»¥è½»æ¾æ‰©å±•æ–°çš„æ–‡ä»¶æ ¼å¼æ”¯æŒï¼š

1. âœ… å®ç° `FileLoaderProtocol`
2. âœ… æ³¨å†Œåˆ° `FileLoaderManager`
3. âœ… æµ‹è¯•å’Œå‘å¸ƒ

**å¼€å§‹å¼€å‘ä½ çš„ç¬¬ä¸€ä¸ªæ’ä»¶å§ï¼** ğŸš€
