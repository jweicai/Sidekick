# TableQuery æŠ€æœ¯æ¶æ„

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           UI Layer (SwiftUI)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Business Logic Layer            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  File    â”‚   SQL    â”‚  Data    â”‚    â”‚
â”‚  â”‚  Loader  â”‚  Engine  â”‚Converter â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Data Access Layer              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ SQLite   â”‚  File    â”‚  Memory  â”‚    â”‚
â”‚  â”‚          â”‚  System  â”‚  Cache   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—

### 1. FileLoaderï¼ˆæ–‡ä»¶åŠ è½½å™¨ï¼‰

**èŒè´£**ï¼š
- å¤„ç†æ–‡ä»¶æ‹–æ‹½
- è§£æä¸åŒæ ¼å¼çš„æ–‡ä»¶ï¼ˆCSVã€JSONã€Excelï¼‰
- æ¨æ–­æ•°æ®ç±»å‹
- å¤§æ–‡ä»¶æµå¼å¤„ç†

**æ¥å£**ï¼š
```swift
protocol FileLoader {
    func load(url: URL) async throws -> DataFrame
    func inferTypes(data: DataFrame) -> [ColumnType]
}

class CSVLoader: FileLoader { }
class JSONLoader: FileLoader { }
class ExcelLoader: FileLoader { }
```

---

### 2. SQLEngineï¼ˆSQL æŸ¥è¯¢å¼•æ“ï¼‰

**èŒè´£**ï¼š
- ç®¡ç† SQLite å†…å­˜æ•°æ®åº“
- åˆ›å»ºä¸´æ—¶è¡¨
- æ‰§è¡Œ SQL æŸ¥è¯¢
- è¿”å›æŸ¥è¯¢ç»“æœ

**æ¥å£**ï¼š
```swift
class SQLEngine {
    private var db: OpaquePointer?
    
    func createTable(name: String, data: DataFrame) throws
    func execute(sql: String) throws -> QueryResult
    func listTables() -> [String]
    func getTableSchema(name: String) -> [Column]
}
```

---

### 3. DataConverterï¼ˆæ•°æ®è½¬æ¢å™¨ï¼‰

**èŒè´£**ï¼š
- æ•°æ®æ ¼å¼è½¬æ¢
- ç”Ÿæˆ INSERT è¯­å¥
- æ•°æ®æ¸…æ´—
- æ•°æ®è„±æ•

**æ¥å£**ï¼š
```swift
class DataConverter {
    func convert(from: DataFormat, to: DataFormat, data: Data) throws -> Data
    func generateInsertSQL(data: DataFrame, config: SQLConfig) -> String
    func clean(data: DataFrame, rules: [CleanRule]) -> DataFrame
    func mask(data: DataFrame, rules: [MaskRule]) -> DataFrame
}
```

---

## ğŸ—‚ï¸ æ•°æ®æ¨¡å‹

### DataFrame
```swift
struct DataFrame {
    let columns: [Column]
    let rows: [[Any]]
    
    var rowCount: Int { rows.count }
    var columnCount: Int { columns.count }
}

struct Column {
    let name: String
    let type: ColumnType
}

enum ColumnType {
    case integer
    case real
    case text
    case blob
    case null
}
```

### QueryResult
```swift
struct QueryResult {
    let columns: [String]
    let rows: [[Any]]
    let executionTime: TimeInterval
    let rowCount: Int
}
```

---

## ğŸ¨ UI ç»„ä»¶

### MainView
```swift
struct MainView: View {
    @StateObject var viewModel: MainViewModel
    
    var body: some View {
        VStack {
            FileDropZone()
            TableList()
            SQLEditor()
            ResultView()
            ActionBar()
        }
    }
}
```

### ViewModel
```swift
class MainViewModel: ObservableObject {
    @Published var loadedTables: [Table] = []
    @Published var sqlQuery: String = ""
    @Published var queryResult: QueryResult?
    @Published var isLoading: Bool = false
    
    private let fileLoader: FileLoader
    private let sqlEngine: SQLEngine
    private let dataConverter: DataConverter
    
    func loadFile(url: URL) async
    func executeQuery() async
    func exportResult(format: DataFormat) async
}
```

---

## ğŸ”§ æŠ€æœ¯é€‰å‹

### æ ¸å¿ƒæŠ€æœ¯
- **è¯­è¨€**ï¼šSwift 5.9+
- **UI æ¡†æ¶**ï¼šSwiftUI
- **æ•°æ®åº“**ï¼šSQLite 3
- **æœ€ä½ç³»ç»Ÿ**ï¼šmacOS 13.0+

### ç¬¬ä¸‰æ–¹åº“
- **CSV è§£æ**ï¼šSwiftCSV æˆ–è‡ªå·±å®ç°
- **Excel æ”¯æŒ**ï¼šCoreXLSX
- **JSON è§£æ**ï¼šFoundation (JSONSerialization)

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### å¤§æ–‡ä»¶å¤„ç†
```swift
class StreamFileLoader {
    func loadLargeFile(url: URL, chunkSize: Int = 1024 * 1024) async throws {
        let fileHandle = try FileHandle(forReadingFrom: url)
        defer { try? fileHandle.close() }
        
        while let chunk = try fileHandle.read(upToCount: chunkSize) {
            // å¤„ç†æ¯ä¸ªå—
            await processChunk(chunk)
        }
    }
}
```

### å†…å­˜ç®¡ç†
- ä½¿ç”¨æµå¼å¤„ç†ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªæ–‡ä»¶
- æŸ¥è¯¢ç»“æœåˆ†é¡µæ˜¾ç¤º
- åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„æ•°æ®

### æŸ¥è¯¢ä¼˜åŒ–
- ä¸ºå¸¸ç”¨åˆ—åˆ›å»ºç´¢å¼•
- ä½¿ç”¨ EXPLAIN QUERY PLAN åˆ†ææŸ¥è¯¢
- é™åˆ¶ç»“æœé›†å¤§å°

---

## ğŸ” å®‰å…¨æ€§

### æ•°æ®å®‰å…¨
- æ‰€æœ‰æ•°æ®å¤„ç†åœ¨æœ¬åœ°è¿›è¡Œ
- ä¸ä¸Šä¼ ä»»ä½•ç”¨æˆ·æ•°æ®
- ä½¿ç”¨ App Sandbox

### SQL æ³¨å…¥é˜²æŠ¤
```swift
func executeQuery(sql: String) throws -> QueryResult {
    // ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
    var statement: OpaquePointer?
    if sqlite3_prepare_v2(db, sql, -1, &statement, nil) == SQLITE_OK {
        // æ‰§è¡ŒæŸ¥è¯¢
    }
}
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•
- FileLoader æµ‹è¯•
- SQLEngine æµ‹è¯•
- DataConverter æµ‹è¯•

### é›†æˆæµ‹è¯•
- ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
- å¤§æ–‡ä»¶å¤„ç†æµ‹è¯•
- æ€§èƒ½æµ‹è¯•

### UI æµ‹è¯•
- æ–‡ä»¶æ‹–æ‹½æµ‹è¯•
- SQL æŸ¥è¯¢æµ‹è¯•
- å¯¼å‡ºåŠŸèƒ½æµ‹è¯•

---

## ğŸ“ˆ å¯æ‰©å±•æ€§

### æ’ä»¶ç³»ç»Ÿï¼ˆæœªæ¥ï¼‰
```swift
protocol TableQueryPlugin {
    var name: String { get }
    var version: String { get }
    
    func initialize()
    func process(input: Data) -> Data
}

class PluginManager {
    func loadPlugin(path: String) -> TableQueryPlugin?
    func registerPlugin(_ plugin: TableQueryPlugin)
}
```

---

## ğŸš€ éƒ¨ç½²

### æ„å»ºé…ç½®
- **Debug**ï¼šå¼€å‘è°ƒè¯•
- **Release**ï¼šApp Store å‘å¸ƒ

### ä»£ç ç­¾å
- Apple Developer è´¦å·
- App Store åˆ†å‘è¯ä¹¦

### ç‰ˆæœ¬ç®¡ç†
- è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼šv1.0.0
- Git Tag æ ‡è®°ç‰ˆæœ¬
